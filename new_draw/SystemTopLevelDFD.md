# 系统顶层数据流图说明

## 1. 系统顶层数据流图概述

系统顶层数据流图展示了整个民宿预订管理系统的主要子系统和它们之间的数据流动关系，如图 1.1 所示。该图提供了系统的全局视图，展示了用户模块、民宿模块、订单模块和支付模块之间如何协同工作，以及系统与外部实体（用户、房东、管理员和支付平台）之间的交互。

## 2. 主要子系统

系统主要包含以下四个核心子系统：

- **用户管理子系统**：负责用户注册、登录、认证、个人信息管理、权限控制等功能。
- **民宿管理子系统**：负责民宿信息发布、查询、搜索、状态管理、评价管理等功能。
- **订单管理子系统**：负责处理订单创建、支付、状态跟踪、取消、退款等流程。
- **支付处理子系统**：负责对接第三方支付平台，处理支付请求、退款、账单生成等功能。

## 3. 主要数据流

### 3.1 用户管理子系统数据流

- **用户 → 用户管理子系统**：用户提交注册信息、登录凭证、个人资料更新请求。
- **用户管理子系统 → 用户**：返回认证结果、用户信息、操作状态。
- **用户管理子系统 → 民宿管理子系统**：提供用户身份验证、权限信息。
- **用户管理子系统 → 订单管理子系统**：提供用户身份验证、联系方式等信息。

### 3.2 民宿管理子系统数据流

- **房东 → 民宿管理子系统**：提交民宿信息、更新状态、回复评价。
- **用户 → 民宿管理子系统**：搜索和查询民宿，提交评价。
- **管理员 → 民宿管理子系统**：审核民宿，管理评价，设置推荐。
- **民宿管理子系统 → 订单管理子系统**：提供民宿可用性、价格、设施等信息。

### 3.3 订单管理子系统数据流

- **用户 → 订单管理子系统**：提交预订请求、取消订单、查询订单。
- **订单管理子系统 → 用户**：返回订单状态、确认信息。
- **订单管理子系统 → 房东**：通知新订单、订单状态变更。
- **订单管理子系统 → 支付处理子系统**：发送支付请求、退款请求。
- **订单管理子系统 → 民宿管理子系统**：更新民宿可用性状态。

### 3.4 支付处理子系统数据流

- **订单管理子系统 → 支付处理子系统**：发送支付请求、退款请求。
- **支付处理子系统 → 订单管理子系统**：返回支付结果、退款状态。
- **支付处理子系统 → 支付平台**：发送支付指令、查询交易状态。
- **支付平台 → 支付处理子系统**：返回支付结果、交易确认。

## 4. 数据存储

整个系统涉及以下主要数据存储：

- **用户数据库**：存储用户、房东和管理员的账户信息。
- **民宿数据库**：存储民宿信息、评价、设施等数据。
- **订单数据库**：存储预订信息、订单状态、支付记录等。
- **支付数据库**：存储支付交易记录、退款记录等。

## 5. 子系统间协作

各子系统通过以下方式协作完成整个业务流程：

1. **预订流程**：

   - 用户通过民宿管理子系统搜索和查看民宿
   - 选择民宿后，订单管理子系统创建预订订单
   - 支付处理子系统处理用户支付
   - 支付成功后，订单管理子系统更新订单状态
   - 民宿管理子系统更新民宿可用性

2. **取消/退款流程**：

   - 用户向订单管理子系统提交取消请求
   - 订单管理子系统验证取消条件
   - 支付处理子系统处理退款
   - 民宿管理子系统恢复民宿可用性

3. **评价流程**：
   - 用户入住完成后，通过民宿管理子系统提交评价
   - 房东收到评价并可以回复
   - 评价数据影响民宿的展示和推荐

## 6. 结论

系统顶层数据流图展示了整个民宿预订管理系统的核心组件及其交互关系。通过这个图，可以清晰地了解系统的整体架构和各个子系统之间的数据流动。这种全局视图有助于理解系统功能之间的依赖关系，确保各个模块能够协调工作，共同支持民宿预订业务的完整流程。
